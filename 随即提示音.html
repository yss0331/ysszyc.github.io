!DOCTYPE html
html lang=zh-CN
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0
    title专注韵律 - Focus Rhythmtitle
    style
         {
            margin 0;
            padding 0;
            box-sizing border-box;
        }

        body {
            font-family -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height 100vh;
            color #333;
            overflow-x hidden;
        }

        .container {
            max-width 1200px;
            margin 0 auto;
            padding 20px;
        }

        .header {
            text-align center;
            margin-bottom 40px;
        }

        .header h1 {
            color white;
            font-size 2.5rem;
            font-weight 300;
            margin-bottom 10px;
            text-shadow 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color rgba(255,255,255,0.9);
            font-size 1.1rem;
        }

        .main-content {
            display grid;
            grid-template-columns 1fr 1fr;
            gap 30px;
            margin-bottom 40px;
        }

        .timer-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 40px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            text-align center;
            backdrop-filter blur(10px);
        }

        .timer-display {
            position relative;
            width 280px;
            height 280px;
            margin 0 auto 30px;
        }

        .timer-circle {
            width 100%;
            height 100%;
            transform rotate(-90deg);
        }

        .timer-circle circle {
            fill none;
            stroke-width 8;
            stroke-linecap round;
        }

        .timer-circle .background {
            stroke #f0f0f0;
        }

        .timer-circle .progress {
            stroke #667eea;
            stroke-dasharray 880;
            stroke-dashoffset 880;
            transition stroke-dashoffset 1s ease;
        }

        .timer-text {
            position absolute;
            top 50%;
            left 50%;
            transform translate(-50%, -50%);
            text-align center;
        }

        .timer-time {
            font-size 3rem;
            font-weight 300;
            color #333;
            margin-bottom 10px;
        }

        .timer-status {
            font-size 1.2rem;
            color #667eea;
            font-weight 500;
        }

        .controls {
            display flex;
            justify-content center;
            gap 20px;
            margin-bottom 30px;
        }

        .btn {
            padding 12px 24px;
            border none;
            border-radius 50px;
            font-size 1rem;
            font-weight 500;
            cursor pointer;
            transition all 0.3s ease;
            box-shadow 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background #667eea;
            color white;
        }

        .btn-primaryhover {
            background #555bdb;
            transform translateY(-2px);
            box-shadow 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background white;
            color #667eea;
            border 2px solid #667eea;
        }

        .btn-secondaryhover {
            background #667eea;
            color white;
            transform translateY(-2px);
        }

        .settings-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 30px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter blur(10px);
        }

        .settings-tab {
            display flex;
            border-bottom 1px solid #eee;
            margin-bottom 25px;
        }

        .tab-btn {
            padding 12px 20px;
            border none;
            background none;
            cursor pointer;
            font-size 1rem;
            color #666;
            border-bottom 3px solid transparent;
            transition all 0.3s ease;
        }

        .tab-btn.active {
            color #667eea;
            border-bottom-color #667eea;
        }

        .tab-content {
            display none;
        }

        .tab-content.active {
            display block;
        }

        .setting-group {
            margin-bottom 25px;
        }

        .setting-label {
            display block;
            margin-bottom 8px;
            font-weight 500;
            color #333;
        }

        .setting-input {
            width 100%;
            padding 10px 15px;
            border 2px solid #e0e0e0;
            border-radius 10px;
            font-size 1rem;
            transition border-color 0.3s ease;
        }

        .setting-inputfocus {
            outline none;
            border-color #667eea;
        }

        .range-group {
            display grid;
            grid-template-columns 1fr 1fr;
            gap 15px;
        }

        .audio-upload {
            display flex;
            align-items center;
            gap 15px;
            padding 15px;
            border 2px dashed #e0e0e0;
            border-radius 10px;
            transition all 0.3s ease;
        }

        .audio-uploadhover {
            border-color #667eea;
            background rgba(102, 126, 234, 0.05);
        }

        .upload-btn {
            background #667eea;
            color white;
            padding 8px 16px;
            border none;
            border-radius 6px;
            cursor pointer;
            font-size 0.9rem;
        }

        .stats-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 30px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter blur(10px);
        }

        .stats-grid {
            display grid;
            grid-template-columns repeat(auto-fit, minmax(200px, 1fr));
            gap 20px;
            margin-bottom 30px;
        }

        .stat-card {
            background white;
            padding 20px;
            border-radius 15px;
            text-align center;
            box-shadow 0 4px 15px rgba(0,0,0,0.08);
        }

        .stat-value {
            font-size 2rem;
            font-weight 600;
            color #667eea;
            margin-bottom 5px;
        }

        .stat-label {
            color #666;
            font-size 0.9rem;
        }

        .chart-container {
            background white;
            padding 20px;
            border-radius 15px;
            box-shadow 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom 20px;
        }

        .chart-placeholder {
            height 200px;
            background linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius 10px;
            display flex;
            align-items center;
            justify-content center;
            color #666;
            font-size 1.1rem;
        }

        .floating-animation {
            animation float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform translateY(0px); }
            50% { transform translateY(-20px); }
        }

        .pulse-animation {
            animation pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform scale(1); }
            50% { transform scale(1.05); }
            100% { transform scale(1); }
        }

        .notification {
            position fixed;
            top 20px;
            right 20px;
            background #4caf50;
            color white;
            padding 15px 20px;
            border-radius 10px;
            box-shadow 0 4px 15px rgba(0,0,0,0.2);
            transform translateX(400px);
            transition transform 0.3s ease;
            z-index 1000;
        }

        .notification.show {
            transform translateX(0);
        }

        .notification.error {
            background #f44336;
        }

        .volume-control {
            display flex;
            align-items center;
            gap 10px;
            margin-bottom 15px;
        }

        .volume-slider {
            flex 1;
            height 6px;
            border-radius 3px;
            background #e0e0e0;
            outline none;
            -webkit-appearance none;
        }

        .volume-slider-webkit-slider-thumb {
            -webkit-appearance none;
            appearance none;
            width 20px;
            height 20px;
            border-radius 50%;
            background #667eea;
            cursor pointer;
        }

        @media (max-width 768px) {
            .main-content {
                grid-template-columns 1fr;
            }
            
            .header h1 {
                font-size 2rem;
            }
            
            .timer-display {
                width 240px;
                height 240px;
            }
            
            .timer-time {
                font-size 2.5rem;
            }
        }

        .ambient-particles {
            position fixed;
            top 0;
            left 0;
            width 100%;
            height 100%;
            pointer-events none;
            z-index -1;
        }

        .particle {
            position absolute;
            background rgba(255,255,255,0.1);
            border-radius 50%;
            animation particleFloat 15s infinite linear;
        }

        @keyframes particleFloat {
            0% {
                transform translateY(100vh) scale(0);
                opacity 0;
            }
            10% {
                opacity 1;
            }
            90% {
                opacity 1;
            }
            100% {
                transform translateY(-10vh) scale(1);
                opacity 0;
            }
        }
    style
head
body
    div class=ambient-particles id=particlesdiv
    
    div class=container
        header class=header
            h1 class=floating-animation专注韵律h1
            pFocus Rhythm - 随机提示音专注助手p
        header

        div class=main-content
            div class=timer-section
                div class=timer-display
                    svg class=timer-circle
                        circle class=background cx=140 cy=140 r=130circle
                        circle class=progress cx=140 cy=140 r=130 id=progressCirclecircle
                    svg
                    div class=timer-text
                        div class=timer-time id=timerTime9000div
                        div class=timer-status id=timerStatus准备就绪div
                    div
                div
                
                div class=controls
                    button class=btn btn-primary id=startBtn开始专注button
                    button class=btn btn-secondary id=pauseBtn暂停button
                    button class=btn btn-secondary id=resetBtn重置button
                div

                div class=next-break id=nextBreakInfo
                    p style=color #666; font-size 0.9rem;下次微休息 span id=nextBreakTime3-5分钟后spanp
                div
            div

            div class=settings-section
                div class=settings-tab
                    button class=tab-btn active data-tab=timing时间设置button
                    button class=tab-btn data-tab=audio音频设置button
                    button class=tab-btn data-tab=preferences个性化button
                div

                div class=tab-content active id=timingTab
                    div class=setting-group
                        label class=setting-label专注单元时长 (分钟)label
                        input type=number class=setting-input id=focusTime value=90 min=1 max=180
                    div
                    
                    div class=setting-group
                        label class=setting-label随机微休息间隔label
                        div class=range-group
                            div
                                label class=setting-label最小间隔 (分钟)label
                                input type=number class=setting-input id=minBreakInterval value=3 min=1 max=30
                            div
                            div
                                label class=setting-label最大间隔 (分钟)label
                                input type=number class=setting-input id=maxBreakInterval value=5 min=1 max=30
                            div
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label微休息时长 (秒)label
                        input type=number class=setting-input id=microBreakDuration value=10 min=5 max=60
                    div
                    
                    div class=setting-group
                        label class=setting-label长时休息时长 (分钟)label
                        input type=number class=setting-input id=longBreakDuration value=20 min=5 max=60
                    div
                div

                div class=tab-content id=audioTab
                    div class=setting-group
                        label class=setting-label音量控制label
                        div class=volume-control
                            span🔊span
                            input type=range class=volume-slider id=volumeSlider min=0 max=100 value=50
                            span id=volumeValue50%span
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label开始专注提示音label
                        div class=audio-upload
                            button class=upload-btn选择文件button
                            input type=file accept=audio style=display none; id=focusStartAudio
                            span id=focusStartFileName使用默认音效span
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('focusStart')试听button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label微休息开始提示音label
                        div class=audio-upload
                            button class=upload-btn选择文件button
                            input type=file accept=audio style=display none; id=microBreakStartAudio
                            span id=microBreakStartFileName使用默认音效span
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('microBreakStart')试听button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label微休息结束提示音label
                        div class=audio-upload
                            button class=upload-btn选择文件button
                            input type=file accept=audio style=display none; id=microBreakEndAudio
                            span id=microBreakEndFileName使用默认音效span
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('microBreakEnd')试听button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label长时休息开始提示音label
                        div class=audio-upload
                            button class=upload-btn选择文件button
                            input type=file accept=audio style=display none; id=longBreakStartAudio
                            span id=longBreakStartFileName使用默认音效span
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('longBreakStart')试听button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-label长时休息结束提示音label
                        div class=audio-upload
                            button class=upload-btn选择文件button
                            input type=file accept=audio style=display none; id=longBreakEndAudio
                            span id=longBreakEndFileName使用默认音效span
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('longBreakEnd')试听button
                        div
                    div
                div

                div class=tab-content id=preferencesTab
                    div class=setting-group
                        label class=setting-label界面主题label
                        select class=setting-input id=themeSelect
                            option value=default默认蓝紫渐变option
                            option value=forest森林绿option
                            option value=sunset日落橙option
                            option value=ocean海洋蓝option
                        select
                    div
                    
                    div class=setting-group
                        label class=setting-label氛围动效label
                        select class=setting-input id=animationSelect
                            option value=particles漂浮粒子option
                            option value=waves波浪动效option
                            option value=none无动效option
                        select
                    div
                    
                    div class=setting-group
                        label class=setting-label通知方式label
                        div style=display flex; gap 20px; align-items center;
                            labelinput type=checkbox id=soundNotification checked 声音提醒label
                            labelinput type=checkbox id=visualNotification checked 视觉提醒label
                            labelinput type=checkbox id=browserNotification 浏览器通知label
                        div
                    div
                div
            div
        div

        div class=stats-section
            h2 style=margin-bottom 25px; color #333;专注统计h2
            
            div class=stats-grid
                div class=stat-card
                    div class=stat-value id=todayTime0分钟div
                    div class=stat-label今日专注div
                div
                div class=stat-card
                    div class=stat-value id=weekTime0分钟div
                    div class=stat-label本周专注div
                div
                div class=stat-card
                    div class=stat-value id=monthTime0分钟div
                    div class=stat-label本月专注div
                div
                div class=stat-card
                    div class=stat-value id=yearTime0分钟div
                    div class=stat-label本年专注div
                div
            div

            div class=chart-container
                h3 style=margin-bottom 15px; color #333;本周专注趋势h3
                div class=chart-placeholder专注时长图表 (开发中)div
            div

            div style=display flex; gap 15px; justify-content center;
                button class=btn btn-secondary onclick=resetStats('day')重置今日button
                button class=btn btn-secondary onclick=resetStats('week')重置本周button
                button class=btn btn-secondary onclick=resetStats('month')重置本月button
                button class=btn btn-secondary onclick=resetStats('year')重置本年button
                button class=btn btn-secondary onclick=customizeStats()自定义调整button
            div
        div
    div

    div class=notification id=notificationdiv

    script
         应用状态
        let appState = {
            isRunning false,
            isPaused false,
            currentPhase 'focus',  'focus', 'microBreak', 'longBreak'
            timeRemaining 90  60,  秒
            totalTime 90  60,
            nextBreakTime null,
            microBreakTimer null,
            focusStartTime null,
            totalFocusTime 0
        };

         设置
        let settings = {
            focusTime 90,
            minBreakInterval 3,
            maxBreakInterval 5,
            microBreakDuration 10,
            longBreakDuration 20,
            volume 50,
            theme 'default',
            animations 'particles',
            notifications {
                sound true,
                visual true,
                browser false
            },
            customAudio {}
        };

         统计数据
        let stats = {
            today 0,
            week 0,
            month 0,
            year 0,
            lastDate new Date().toDateString()
        };

         DOM 元素
        const timerTime = document.getElementById('timerTime');
        const timerStatus = document.getElementById('timerStatus');
        const progressCircle = document.getElementById('progressCircle');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const nextBreakInfo = document.getElementById('nextBreakInfo');
        const nextBreakTime = document.getElementById('nextBreakTime');

         初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadStats();
            updateDisplay();
            setupEventListeners();
            createParticles();
            scheduleNextBreak();
        });

         设置事件监听器
        function setupEventListeners() {
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);

             标签页切换
            document.querySelectorAll('.tab-btn').forEach(btn = {
                btn.addEventListener('click', () = switchTab(btn.dataset.tab));
            });

             设置变更监听
            document.getElementById('focusTime').addEventListener('change', updateFocusTime);
            document.getElementById('minBreakInterval').addEventListener('change', saveSettings);
            document.getElementById('maxBreakInterval').addEventListener('change', saveSettings);
            document.getElementById('microBreakDuration').addEventListener('change', saveSettings);
            document.getElementById('longBreakDuration').addEventListener('change', saveSettings);
            
             音量控制
            const volumeSlider = document.getElementById('volumeSlider');
            volumeSlider.addEventListener('input', updateVolume);

             音频文件上传
            setupAudioUploads();

             主题切换
            document.getElementById('themeSelect').addEventListener('change', changeTheme);
            document.getElementById('animationSelect').addEventListener('change', changeAnimation);
        }

         切换标签页
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn = btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content = content.classList.remove('active'));
            
            document.querySelector(`[data-tab=${tabName}]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

         开始计时器
        function startTimer() {
            if (!appState.isRunning) {
                appState.isRunning = true;
                appState.isPaused = false;
                appState.focusStartTime = Date.now();
                
                if (appState.currentPhase === 'focus') {
                    playSound('focusStart');
                    scheduleNextBreak();
                }
                
                startBtn.textContent = '专注中';
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                countdown();
                showNotification('开始专注，加油！', 'success');
            }
        }

         暂停计时器
        function pauseTimer() {
            if (appState.isRunning && !appState.isPaused) {
                appState.isPaused = true;
                startBtn.textContent = '继续';
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                 取消微休息计时器
                if (appState.microBreakTimer) {
                    clearTimeout(appState.microBreakTimer);
                    appState.microBreakTimer = null;
                }
                
                showNotification('暂停计时', 'info');
            } else if (appState.isPaused) {
                appState.isPaused = false;
                startBtn.textContent = '专注中';
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                 重新安排微休息
                if (appState.currentPhase === 'focus') {
                    scheduleNextBreak();
                }
                
                countdown();
                showNotification('继续专注', 'success');
            }
        }

         重置计时器
        function resetTimer() {
            appState.isRunning = false;
            appState.isPaused = false;
            appState.currentPhase = 'focus';
            appState.timeRemaining = settings.focusTime  60;
            appState.totalTime = settings.focusTime  60;
            
            if (appState.microBreakTimer) {
                clearTimeout(appState.microBreakTimer);
                appState.microBreakTimer = null;
            }
            
            startBtn.textContent = '开始专注';
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            updateDisplay();
            scheduleNextBreak();
            showNotification('计时器已重置', 'info');
        }

         倒计时
        function countdown() {
            if (!appState.isRunning  appState.isPaused) return;
            
            if (appState.timeRemaining = 0) {
                handlePhaseComplete();
                return;
            }
            
            appState.timeRemaining--;
            updateDisplay();
            
            setTimeout(countdown, 1000);
        }

         处理阶段完成
        function handlePhaseComplete() {
            switch(appState.currentPhase) {
                case 'focus'
                     记录专注时间
                    recordFocusTime();
                    
                     开始长时休息
                    appState.currentPhase = 'longBreak';
                    appState.timeRemaining = settings.longBreakDuration  60;
                    appState.totalTime = settings.longBreakDuration  60;
                    timerStatus.textContent = '长时休息中';
                    
                    playSound('longBreakStart');
                    showNotification(`专注完成！开始${settings.longBreakDuration}分钟休息`, 'success');
                    break;
                    
                case 'microBreak'
                     微休息结束，返回专注
                    appState.currentPhase = 'focus';
                    timerStatus.textContent = '专注中';
                    
                    playSound('microBreakEnd');
                    showNotification('微休息结束，继续专注！', 'success');
                    scheduleNextBreak();
                    break;
                    
                case 'longBreak'
                     长时休息结束，开始新的专注周期
                    appState.currentPhase = 'focus';
                    appState.timeRemaining = settings.focusTime  60;
                    appState.totalTime = settings.focusTime  60;
                    timerStatus.textContent = '准备就绪';
                    
                    playSound('longBreakEnd');
                    showNotification('休息结束！准备开始新的专注周期', 'success');
                    
                     自动重置到等待状态
                    appState.isRunning = false;
                    startBtn.textContent = '开始专注';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    break;
            }
            
            updateDisplay();
            
             如果不是长时休息结束，继续倒计时
            if (!(appState.currentPhase === 'focus' && appState.timeRemaining === settings.focusTime  60)) {
                countdown();
            }
        }

         安排下一次微休息
        function scheduleNextBreak() {
            if (appState.microBreakTimer) {
                clearTimeout(appState.microBreakTimer);
            }
            
            if (appState.currentPhase !== 'focus'  !appState.isRunning  appState.isPaused) {
                nextBreakTime.textContent = '暂停中';
                return;
            }
            
            const minInterval = settings.minBreakInterval  60  1000;  转换为毫秒
            const maxInterval = settings.maxBreakInterval  60  1000;
            const randomInterval = Math.random()  (maxInterval - minInterval) + minInterval;
            
            appState.nextBreakTime = Date.now() + randomInterval;
            
             更新显示
            const minutes = Math.floor(randomInterval  60000);
            const seconds = Math.floor((randomInterval % 60000)  1000);
            nextBreakTime.textContent = `${minutes}分${seconds}秒后`;
            
            appState.microBreakTimer = setTimeout(() = {
                if (appState.currentPhase === 'focus' && appState.isRunning && !appState.isPaused) {
                    startMicroBreak();
                }
            }, randomInterval);
        }

         开始微休息
        function startMicroBreak() {
            appState.currentPhase = 'microBreak';
            appState.timeRemaining = settings.microBreakDuration;
            appState.totalTime = settings.microBreakDuration;
            timerStatus.textContent = '微休息中';
            
            playSound('microBreakStart');
            showNotification(`微休息时间！${settings.microBreakDuration}秒后继续专注`, 'info');
            
            updateDisplay();
        }

         记录专注时间
        function recordFocusTime() {
            if (!appState.focusStartTime) return;
            
            const focusedMinutes = Math.floor((Date.now() - appState.focusStartTime)  60000);
            
             检查是否是新的一天
            const today = new Date().toDateString();
            if (stats.lastDate !== today) {
                resetDailyStats();
                stats.lastDate = today;
            }
            
            stats.today += focusedMinutes;
            stats.week += focusedMinutes;
            stats.month += focusedMinutes;
            stats.year += focusedMinutes;
            
            saveStats();
            updateStatsDisplay();
            
            appState.focusStartTime = null;
        }

         播放声音
        function playSound(type) {
            if (!settings.notifications.sound) return;
            
             如果有自定义音频，播放自定义音频
            if (settings.customAudio[type]) {
                const audio = new Audio(settings.customAudio[type]);
                audio.volume = settings.volume  100;
                audio.play().catch(e = console.log('音频播放失败', e));
                return;
            }
            
             否则播放默认音频（使用AudioContext生成）
            playDefaultSound(type);
        }

         播放默认音效
        function playDefaultSound(type) {
            const audioContext = new (window.AudioContext  window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
             根据类型设置不同的音频参数
            switch(type) {
                case 'focusStart'
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.5);
                    break;
                case 'microBreakStart'
                    oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                    break;
                case 'microBreakEnd'
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.3);
                    break;
                case 'longBreakStart'
                    oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(660, audioContext.currentTime + 1);
                    break;
                case 'longBreakEnd'
                    oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 0.8);
                    break;
            }
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(settings.volume  100  0.3, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        }

         预览音频
        function playPreview(type) {
            playSound(type);
        }

         更新显示
        function updateDisplay() {
             更新计时器显示
            const minutes = Math.floor(appState.timeRemaining  60);
            const seconds = appState.timeRemaining % 60;
            timerTime.textContent = `${minutes.toString().padStart(2, '0')}${seconds.toString().padStart(2, '0')}`;
            
             更新进度圆环
            const progress = 1 - (appState.timeRemaining  appState.totalTime);
            const offset = 880 - (progress  880);
            progressCircle.style.strokeDashoffset = offset;
            
             根据阶段更改进度圆环颜色
            switch(appState.currentPhase) {
                case 'focus'
                    progressCircle.style.stroke = '#667eea';
                    timerStatus.textContent = appState.isRunning  '专注中'  '准备就绪';
                    break;
                case 'microBreak'
                    progressCircle.style.stroke = '#4caf50';
                    timerStatus.textContent = '微休息中';
                    break;
                case 'longBreak'
                    progressCircle.style.stroke = '#ff9800';
                    timerStatus.textContent = '长时休息中';
                    break;
            }
            
             更新下次休息时间显示
            if (appState.currentPhase === 'focus' && appState.isRunning && !appState.isPaused && appState.nextBreakTime) {
                const now = Date.now();
                const remaining = Math.max(0, appState.nextBreakTime - now);
                const minutes = Math.floor(remaining  60000);
                const seconds = Math.floor((remaining % 60000)  1000);
                
                if (remaining  0) {
                    nextBreakTime.textContent = `${minutes}分${seconds}秒后`;
                } else {
                    nextBreakTime.textContent = '即将到来';
                }
            } else if (!appState.isRunning  appState.isPaused) {
                nextBreakTime.textContent = `${settings.minBreakInterval}-${settings.maxBreakInterval}分钟后`;
            }
        }

         更新专注时间设置
        function updateFocusTime() {
            const newTime = parseInt(document.getElementById('focusTime').value)  90;
            settings.focusTime = newTime;
            
            if (!appState.isRunning) {
                appState.timeRemaining = newTime  60;
                appState.totalTime = newTime  60;
                updateDisplay();
            }
            
            saveSettings();
        }

         更新音量
        function updateVolume() {
            const volume = parseInt(document.getElementById('volumeSlider').value);
            settings.volume = volume;
            document.getElementById('volumeValue').textContent = volume + '%';
            saveSettings();
        }

         设置音频上传
        function setupAudioUploads() {
            const audioTypes = ['focusStart', 'microBreakStart', 'microBreakEnd', 'longBreakStart', 'longBreakEnd'];
            
            audioTypes.forEach(type = {
                const input = document.getElementById(type + 'Audio');
                const button = input.previousElementSibling;
                const fileName = document.getElementById(type + 'FileName');
                
                button.addEventListener('click', () = input.click());
                
                input.addEventListener('change', (e) = {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) = {
                            settings.customAudio[type] = e.target.result;
                            fileName.textContent = file.name;
                            saveSettings();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        }

         更改主题
        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            settings.theme = theme;
            applyTheme(theme);
            saveSettings();
        }

         应用主题
        function applyTheme(theme) {
            const body = document.body;
            const themes = {
                default 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                forest 'linear-gradient(135deg, #2d5a27 0%, #4a7c59 100%)',
                sunset 'linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%)',
                ocean 'linear-gradient(135deg, #3742fa 0%, #2f3542 100%)'
            };
            
            body.style.background = themes[theme]  themes.default;
        }

         更改动画效果
        function changeAnimation() {
            const animation = document.getElementById('animationSelect').value;
            settings.animations = animation;
            applyAnimation(animation);
            saveSettings();
        }

         应用动画效果
        function applyAnimation(animation) {
            const particlesContainer = document.getElementById('particles');
            
            switch(animation) {
                case 'particles'
                    createParticles();
                    break;
                case 'waves'
                    createWaves();
                    break;
                case 'none'
                    particlesContainer.innerHTML = '';
                    break;
            }
        }

         创建粒子动画
        function createParticles() {
            const container = document.getElementById('particles');
            container.innerHTML = '';
            
            for (let i = 0; i  20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random()  100 + '%';
                particle.style.width = particle.style.height = Math.random()  4 + 2 + 'px';
                particle.style.animationDelay = Math.random()  15 + 's';
                particle.style.animationDuration = (Math.random()  10 + 10) + 's';
                container.appendChild(particle);
            }
        }

         创建波浪动画
        function createWaves() {
            const container = document.getElementById('particles');
            container.innerHTML = `
                svg width=100% height=100% viewBox=0 0 1200 600 style=position absolute; top 0; left 0;
                    path d=M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z 
                          fill=rgba(255,255,255,0.05)
                        animate attributeName=d 
                                 values=M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z;
                                         M0,300 Q300,400 600,300 T1200,300 L1200,600 L0,600 Z;
                                         M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z
                                 dur=8s repeatCount=indefinite
                    path
                svg
            `;
        }

         显示通知
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
             浏览器通知
            if (settings.notifications.browser && 'Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('专注韵律', { body message, icon 'favicon.ico' });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission = {
                        if (permission === 'granted') {
                            new Notification('专注韵律', { body message, icon 'favicon.ico' });
                        }
                    });
                }
            }
            
            setTimeout(() = {
                notification.classList.remove('show');
            }, 3000);
        }

         更新统计显示
        function updateStatsDisplay() {
            document.getElementById('todayTime').textContent = formatTime(stats.today);
            document.getElementById('weekTime').textContent = formatTime(stats.week);
            document.getElementById('monthTime').textContent = formatTime(stats.month);
            document.getElementById('yearTime').textContent = formatTime(stats.year);
        }

         格式化时间显示
        function formatTime(minutes) {
            if (minutes  60) {
                return minutes + '分钟';
            } else {
                const hours = Math.floor(minutes  60);
                const mins = minutes % 60;
                return `${hours}小时${mins  0  mins + '分钟'  ''}`;
            }
        }

         重置统计数据
        function resetStats(period) {
            if (confirm(`确定要重置${{'day' '今日', 'week' '本周', 'month' '本月', 'year' '本年'}[period]}的统计数据吗？`)) {
                switch(period) {
                    case 'day'
                        stats.today = 0;
                        break;
                    case 'week'
                        stats.week = 0;
                        break;
                    case 'month'
                        stats.month = 0;
                        break;
                    case 'year'
                        stats.year = 0;
                        break;
                }
                saveStats();
                updateStatsDisplay();
                showNotification(`${{'day' '今日', 'week' '本周', 'month' '本月', 'year' '本年'}[period]}统计已重置`, 'success');
            }
        }

         自定义统计调整
        function customizeStats() {
            const customTime = prompt('请输入要调整的专注时间（分钟）：');
            if (customTime && !isNaN(customTime)) {
                const minutes = parseInt(customTime);
                const period = prompt('调整哪个周期？n1. 今日n2. 本周n3. 本月n4. 本年');
                
                switch(period) {
                    case '1'
                        stats.today = Math.max(0, minutes);
                        break;
                    case '2'
                        stats.week = Math.max(0, minutes);
                        break;
                    case '3'
                        stats.month = Math.max(0, minutes);
                        break;
                    case '4'
                        stats.year = Math.max(0, minutes);
                        break;
                    default
                        return;
                }
                
                saveStats();
                updateStatsDisplay();
                showNotification('统计数据已更新', 'success');
            }
        }

         检查日期变化，重置每日统计
        function resetDailyStats() {
             这里可以添加更复杂的逻辑，比如将昨日数据保存到历史记录
            stats.today = 0;
        }

         保存设置到 localStorage
        function saveSettings() {
            localStorage.setItem('focusRhythmSettings', JSON.stringify(settings));
        }

         从 localStorage 加载设置
        function loadSettings() {
            const saved = localStorage.getItem('focusRhythmSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
                
                 更新 UI
                document.getElementById('focusTime').value = settings.focusTime;
                document.getElementById('minBreakInterval').value = settings.minBreakInterval;
                document.getElementById('maxBreakInterval').value = settings.maxBreakInterval;
                document.getElementById('microBreakDuration').value = settings.microBreakDuration;
                document.getElementById('longBreakDuration').value = settings.longBreakDuration;
                document.getElementById('volumeSlider').value = settings.volume;
                document.getElementById('volumeValue').textContent = settings.volume + '%';
                document.getElementById('themeSelect').value = settings.theme;
                document.getElementById('animationSelect').value = settings.animations;
                
                 应用主题和动画
                applyTheme(settings.theme);
                applyAnimation(settings.animations);
                
                 更新计时器时间
                if (!appState.isRunning) {
                    appState.timeRemaining = settings.focusTime  60;
                    appState.totalTime = settings.focusTime  60;
                }
            }
        }

         保存统计数据到 localStorage
        function saveStats() {
            localStorage.setItem('focusRhythmStats', JSON.stringify(stats));
        }

         从 localStorage 加载统计数据
        function loadStats() {
            const saved = localStorage.getItem('focusRhythmStats');
            if (saved) {
                stats = { ...stats, ...JSON.parse(saved) };
                
                 检查是否是新的一天
                const today = new Date().toDateString();
                if (stats.lastDate !== today) {
                    resetDailyStats();
                    stats.lastDate = today;
                    saveStats();
                }
            }
            updateStatsDisplay();
        }

         页面可见性变化处理
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && appState.isRunning && !appState.isPaused) {
                 页面重新可见时，重新安排微休息（防止时间不准确）
                if (appState.currentPhase === 'focus') {
                    scheduleNextBreak();
                }
            }
        });

         键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName.toLowerCase() === 'input') return;
            
            switch(e.code) {
                case 'Space'
                    e.preventDefault();
                    if (!appState.isRunning) {
                        startTimer();
                    } else if (!appState.isPaused) {
                        pauseTimer();
                    } else {
                        pauseTimer();  继续
                    }
                    break;
                case 'KeyR'
                    if (e.ctrlKey  e.metaKey) {
                        e.preventDefault();
                        resetTimer();
                    }
                    break;
            }
        });

         定期更新显示（用于下次休息时间倒计时）
        setInterval(() = {
            if (appState.isRunning && !appState.isPaused && appState.currentPhase === 'focus') {
                updateDisplay();
            }
        }, 1000);
    script
body
html