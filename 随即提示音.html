!DOCTYPE html
html lang=zh-CN
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0
    titleä¸“æ³¨éŸµå¾‹ - Focus Rhythmtitle
    style
         {
            margin 0;
            padding 0;
            box-sizing border-box;
        }

        body {
            font-family -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height 100vh;
            color #333;
            overflow-x hidden;
        }

        .container {
            max-width 1200px;
            margin 0 auto;
            padding 20px;
        }

        .header {
            text-align center;
            margin-bottom 40px;
        }

        .header h1 {
            color white;
            font-size 2.5rem;
            font-weight 300;
            margin-bottom 10px;
            text-shadow 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color rgba(255,255,255,0.9);
            font-size 1.1rem;
        }

        .main-content {
            display grid;
            grid-template-columns 1fr 1fr;
            gap 30px;
            margin-bottom 40px;
        }

        .timer-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 40px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            text-align center;
            backdrop-filter blur(10px);
        }

        .timer-display {
            position relative;
            width 280px;
            height 280px;
            margin 0 auto 30px;
        }

        .timer-circle {
            width 100%;
            height 100%;
            transform rotate(-90deg);
        }

        .timer-circle circle {
            fill none;
            stroke-width 8;
            stroke-linecap round;
        }

        .timer-circle .background {
            stroke #f0f0f0;
        }

        .timer-circle .progress {
            stroke #667eea;
            stroke-dasharray 880;
            stroke-dashoffset 880;
            transition stroke-dashoffset 1s ease;
        }

        .timer-text {
            position absolute;
            top 50%;
            left 50%;
            transform translate(-50%, -50%);
            text-align center;
        }

        .timer-time {
            font-size 3rem;
            font-weight 300;
            color #333;
            margin-bottom 10px;
        }

        .timer-status {
            font-size 1.2rem;
            color #667eea;
            font-weight 500;
        }

        .controls {
            display flex;
            justify-content center;
            gap 20px;
            margin-bottom 30px;
        }

        .btn {
            padding 12px 24px;
            border none;
            border-radius 50px;
            font-size 1rem;
            font-weight 500;
            cursor pointer;
            transition all 0.3s ease;
            box-shadow 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background #667eea;
            color white;
        }

        .btn-primaryhover {
            background #555bdb;
            transform translateY(-2px);
            box-shadow 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background white;
            color #667eea;
            border 2px solid #667eea;
        }

        .btn-secondaryhover {
            background #667eea;
            color white;
            transform translateY(-2px);
        }

        .settings-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 30px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter blur(10px);
        }

        .settings-tab {
            display flex;
            border-bottom 1px solid #eee;
            margin-bottom 25px;
        }

        .tab-btn {
            padding 12px 20px;
            border none;
            background none;
            cursor pointer;
            font-size 1rem;
            color #666;
            border-bottom 3px solid transparent;
            transition all 0.3s ease;
        }

        .tab-btn.active {
            color #667eea;
            border-bottom-color #667eea;
        }

        .tab-content {
            display none;
        }

        .tab-content.active {
            display block;
        }

        .setting-group {
            margin-bottom 25px;
        }

        .setting-label {
            display block;
            margin-bottom 8px;
            font-weight 500;
            color #333;
        }

        .setting-input {
            width 100%;
            padding 10px 15px;
            border 2px solid #e0e0e0;
            border-radius 10px;
            font-size 1rem;
            transition border-color 0.3s ease;
        }

        .setting-inputfocus {
            outline none;
            border-color #667eea;
        }

        .range-group {
            display grid;
            grid-template-columns 1fr 1fr;
            gap 15px;
        }

        .audio-upload {
            display flex;
            align-items center;
            gap 15px;
            padding 15px;
            border 2px dashed #e0e0e0;
            border-radius 10px;
            transition all 0.3s ease;
        }

        .audio-uploadhover {
            border-color #667eea;
            background rgba(102, 126, 234, 0.05);
        }

        .upload-btn {
            background #667eea;
            color white;
            padding 8px 16px;
            border none;
            border-radius 6px;
            cursor pointer;
            font-size 0.9rem;
        }

        .stats-section {
            background rgba(255,255,255,0.95);
            border-radius 20px;
            padding 30px;
            box-shadow 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter blur(10px);
        }

        .stats-grid {
            display grid;
            grid-template-columns repeat(auto-fit, minmax(200px, 1fr));
            gap 20px;
            margin-bottom 30px;
        }

        .stat-card {
            background white;
            padding 20px;
            border-radius 15px;
            text-align center;
            box-shadow 0 4px 15px rgba(0,0,0,0.08);
        }

        .stat-value {
            font-size 2rem;
            font-weight 600;
            color #667eea;
            margin-bottom 5px;
        }

        .stat-label {
            color #666;
            font-size 0.9rem;
        }

        .chart-container {
            background white;
            padding 20px;
            border-radius 15px;
            box-shadow 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom 20px;
        }

        .chart-placeholder {
            height 200px;
            background linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius 10px;
            display flex;
            align-items center;
            justify-content center;
            color #666;
            font-size 1.1rem;
        }

        .floating-animation {
            animation float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform translateY(0px); }
            50% { transform translateY(-20px); }
        }

        .pulse-animation {
            animation pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform scale(1); }
            50% { transform scale(1.05); }
            100% { transform scale(1); }
        }

        .notification {
            position fixed;
            top 20px;
            right 20px;
            background #4caf50;
            color white;
            padding 15px 20px;
            border-radius 10px;
            box-shadow 0 4px 15px rgba(0,0,0,0.2);
            transform translateX(400px);
            transition transform 0.3s ease;
            z-index 1000;
        }

        .notification.show {
            transform translateX(0);
        }

        .notification.error {
            background #f44336;
        }

        .volume-control {
            display flex;
            align-items center;
            gap 10px;
            margin-bottom 15px;
        }

        .volume-slider {
            flex 1;
            height 6px;
            border-radius 3px;
            background #e0e0e0;
            outline none;
            -webkit-appearance none;
        }

        .volume-slider-webkit-slider-thumb {
            -webkit-appearance none;
            appearance none;
            width 20px;
            height 20px;
            border-radius 50%;
            background #667eea;
            cursor pointer;
        }

        @media (max-width 768px) {
            .main-content {
                grid-template-columns 1fr;
            }
            
            .header h1 {
                font-size 2rem;
            }
            
            .timer-display {
                width 240px;
                height 240px;
            }
            
            .timer-time {
                font-size 2.5rem;
            }
        }

        .ambient-particles {
            position fixed;
            top 0;
            left 0;
            width 100%;
            height 100%;
            pointer-events none;
            z-index -1;
        }

        .particle {
            position absolute;
            background rgba(255,255,255,0.1);
            border-radius 50%;
            animation particleFloat 15s infinite linear;
        }

        @keyframes particleFloat {
            0% {
                transform translateY(100vh) scale(0);
                opacity 0;
            }
            10% {
                opacity 1;
            }
            90% {
                opacity 1;
            }
            100% {
                transform translateY(-10vh) scale(1);
                opacity 0;
            }
        }
    style
head
body
    div class=ambient-particles id=particlesdiv
    
    div class=container
        header class=header
            h1 class=floating-animationä¸“æ³¨éŸµå¾‹h1
            pFocus Rhythm - éšæœºæç¤ºéŸ³ä¸“æ³¨åŠ©æ‰‹p
        header

        div class=main-content
            div class=timer-section
                div class=timer-display
                    svg class=timer-circle
                        circle class=background cx=140 cy=140 r=130circle
                        circle class=progress cx=140 cy=140 r=130 id=progressCirclecircle
                    svg
                    div class=timer-text
                        div class=timer-time id=timerTime9000div
                        div class=timer-status id=timerStatuså‡†å¤‡å°±ç»ªdiv
                    div
                div
                
                div class=controls
                    button class=btn btn-primary id=startBtnå¼€å§‹ä¸“æ³¨button
                    button class=btn btn-secondary id=pauseBtnæš‚åœbutton
                    button class=btn btn-secondary id=resetBtné‡ç½®button
                div

                div class=next-break id=nextBreakInfo
                    p style=color #666; font-size 0.9rem;ä¸‹æ¬¡å¾®ä¼‘æ¯ span id=nextBreakTime3-5åˆ†é’Ÿåspanp
                div
            div

            div class=settings-section
                div class=settings-tab
                    button class=tab-btn active data-tab=timingæ—¶é—´è®¾ç½®button
                    button class=tab-btn data-tab=audioéŸ³é¢‘è®¾ç½®button
                    button class=tab-btn data-tab=preferencesä¸ªæ€§åŒ–button
                div

                div class=tab-content active id=timingTab
                    div class=setting-group
                        label class=setting-labelä¸“æ³¨å•å…ƒæ—¶é•¿ (åˆ†é’Ÿ)label
                        input type=number class=setting-input id=focusTime value=90 min=1 max=180
                    div
                    
                    div class=setting-group
                        label class=setting-labeléšæœºå¾®ä¼‘æ¯é—´éš”label
                        div class=range-group
                            div
                                label class=setting-labelæœ€å°é—´éš” (åˆ†é’Ÿ)label
                                input type=number class=setting-input id=minBreakInterval value=3 min=1 max=30
                            div
                            div
                                label class=setting-labelæœ€å¤§é—´éš” (åˆ†é’Ÿ)label
                                input type=number class=setting-input id=maxBreakInterval value=5 min=1 max=30
                            div
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelå¾®ä¼‘æ¯æ—¶é•¿ (ç§’)label
                        input type=number class=setting-input id=microBreakDuration value=10 min=5 max=60
                    div
                    
                    div class=setting-group
                        label class=setting-labelé•¿æ—¶ä¼‘æ¯æ—¶é•¿ (åˆ†é’Ÿ)label
                        input type=number class=setting-input id=longBreakDuration value=20 min=5 max=60
                    div
                div

                div class=tab-content id=audioTab
                    div class=setting-group
                        label class=setting-labeléŸ³é‡æ§åˆ¶label
                        div class=volume-control
                            spanğŸ”Šspan
                            input type=range class=volume-slider id=volumeSlider min=0 max=100 value=50
                            span id=volumeValue50%span
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelå¼€å§‹ä¸“æ³¨æç¤ºéŸ³label
                        div class=audio-upload
                            button class=upload-btné€‰æ‹©æ–‡ä»¶button
                            input type=file accept=audio style=display none; id=focusStartAudio
                            span id=focusStartFileNameä½¿ç”¨é»˜è®¤éŸ³æ•ˆspan
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('focusStart')è¯•å¬button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelå¾®ä¼‘æ¯å¼€å§‹æç¤ºéŸ³label
                        div class=audio-upload
                            button class=upload-btné€‰æ‹©æ–‡ä»¶button
                            input type=file accept=audio style=display none; id=microBreakStartAudio
                            span id=microBreakStartFileNameä½¿ç”¨é»˜è®¤éŸ³æ•ˆspan
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('microBreakStart')è¯•å¬button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelå¾®ä¼‘æ¯ç»“æŸæç¤ºéŸ³label
                        div class=audio-upload
                            button class=upload-btné€‰æ‹©æ–‡ä»¶button
                            input type=file accept=audio style=display none; id=microBreakEndAudio
                            span id=microBreakEndFileNameä½¿ç”¨é»˜è®¤éŸ³æ•ˆspan
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('microBreakEnd')è¯•å¬button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelé•¿æ—¶ä¼‘æ¯å¼€å§‹æç¤ºéŸ³label
                        div class=audio-upload
                            button class=upload-btné€‰æ‹©æ–‡ä»¶button
                            input type=file accept=audio style=display none; id=longBreakStartAudio
                            span id=longBreakStartFileNameä½¿ç”¨é»˜è®¤éŸ³æ•ˆspan
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('longBreakStart')è¯•å¬button
                        div
                    div
                    
                    div class=setting-group
                        label class=setting-labelé•¿æ—¶ä¼‘æ¯ç»“æŸæç¤ºéŸ³label
                        div class=audio-upload
                            button class=upload-btné€‰æ‹©æ–‡ä»¶button
                            input type=file accept=audio style=display none; id=longBreakEndAudio
                            span id=longBreakEndFileNameä½¿ç”¨é»˜è®¤éŸ³æ•ˆspan
                            button class=btn-secondary style=margin-left auto; onclick=playPreview('longBreakEnd')è¯•å¬button
                        div
                    div
                div

                div class=tab-content id=preferencesTab
                    div class=setting-group
                        label class=setting-labelç•Œé¢ä¸»é¢˜label
                        select class=setting-input id=themeSelect
                            option value=defaulté»˜è®¤è“ç´«æ¸å˜option
                            option value=forestæ£®æ—ç»¿option
                            option value=sunsetæ—¥è½æ©™option
                            option value=oceanæµ·æ´‹è“option
                        select
                    div
                    
                    div class=setting-group
                        label class=setting-labelæ°›å›´åŠ¨æ•ˆlabel
                        select class=setting-input id=animationSelect
                            option value=particlesæ¼‚æµ®ç²’å­option
                            option value=wavesæ³¢æµªåŠ¨æ•ˆoption
                            option value=noneæ— åŠ¨æ•ˆoption
                        select
                    div
                    
                    div class=setting-group
                        label class=setting-labelé€šçŸ¥æ–¹å¼label
                        div style=display flex; gap 20px; align-items center;
                            labelinput type=checkbox id=soundNotification checked å£°éŸ³æé†’label
                            labelinput type=checkbox id=visualNotification checked è§†è§‰æé†’label
                            labelinput type=checkbox id=browserNotification æµè§ˆå™¨é€šçŸ¥label
                        div
                    div
                div
            div
        div

        div class=stats-section
            h2 style=margin-bottom 25px; color #333;ä¸“æ³¨ç»Ÿè®¡h2
            
            div class=stats-grid
                div class=stat-card
                    div class=stat-value id=todayTime0åˆ†é’Ÿdiv
                    div class=stat-labelä»Šæ—¥ä¸“æ³¨div
                div
                div class=stat-card
                    div class=stat-value id=weekTime0åˆ†é’Ÿdiv
                    div class=stat-labelæœ¬å‘¨ä¸“æ³¨div
                div
                div class=stat-card
                    div class=stat-value id=monthTime0åˆ†é’Ÿdiv
                    div class=stat-labelæœ¬æœˆä¸“æ³¨div
                div
                div class=stat-card
                    div class=stat-value id=yearTime0åˆ†é’Ÿdiv
                    div class=stat-labelæœ¬å¹´ä¸“æ³¨div
                div
            div

            div class=chart-container
                h3 style=margin-bottom 15px; color #333;æœ¬å‘¨ä¸“æ³¨è¶‹åŠ¿h3
                div class=chart-placeholderä¸“æ³¨æ—¶é•¿å›¾è¡¨ (å¼€å‘ä¸­)div
            div

            div style=display flex; gap 15px; justify-content center;
                button class=btn btn-secondary onclick=resetStats('day')é‡ç½®ä»Šæ—¥button
                button class=btn btn-secondary onclick=resetStats('week')é‡ç½®æœ¬å‘¨button
                button class=btn btn-secondary onclick=resetStats('month')é‡ç½®æœ¬æœˆbutton
                button class=btn btn-secondary onclick=resetStats('year')é‡ç½®æœ¬å¹´button
                button class=btn btn-secondary onclick=customizeStats()è‡ªå®šä¹‰è°ƒæ•´button
            div
        div
    div

    div class=notification id=notificationdiv

    script
         åº”ç”¨çŠ¶æ€
        let appState = {
            isRunning false,
            isPaused false,
            currentPhase 'focus',  'focus', 'microBreak', 'longBreak'
            timeRemaining 90  60,  ç§’
            totalTime 90  60,
            nextBreakTime null,
            microBreakTimer null,
            focusStartTime null,
            totalFocusTime 0
        };

         è®¾ç½®
        let settings = {
            focusTime 90,
            minBreakInterval 3,
            maxBreakInterval 5,
            microBreakDuration 10,
            longBreakDuration 20,
            volume 50,
            theme 'default',
            animations 'particles',
            notifications {
                sound true,
                visual true,
                browser false
            },
            customAudio {}
        };

         ç»Ÿè®¡æ•°æ®
        let stats = {
            today 0,
            week 0,
            month 0,
            year 0,
            lastDate new Date().toDateString()
        };

         DOM å…ƒç´ 
        const timerTime = document.getElementById('timerTime');
        const timerStatus = document.getElementById('timerStatus');
        const progressCircle = document.getElementById('progressCircle');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const nextBreakInfo = document.getElementById('nextBreakInfo');
        const nextBreakTime = document.getElementById('nextBreakTime');

         åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadStats();
            updateDisplay();
            setupEventListeners();
            createParticles();
            scheduleNextBreak();
        });

         è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);

             æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab-btn').forEach(btn = {
                btn.addEventListener('click', () = switchTab(btn.dataset.tab));
            });

             è®¾ç½®å˜æ›´ç›‘å¬
            document.getElementById('focusTime').addEventListener('change', updateFocusTime);
            document.getElementById('minBreakInterval').addEventListener('change', saveSettings);
            document.getElementById('maxBreakInterval').addEventListener('change', saveSettings);
            document.getElementById('microBreakDuration').addEventListener('change', saveSettings);
            document.getElementById('longBreakDuration').addEventListener('change', saveSettings);
            
             éŸ³é‡æ§åˆ¶
            const volumeSlider = document.getElementById('volumeSlider');
            volumeSlider.addEventListener('input', updateVolume);

             éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ 
            setupAudioUploads();

             ä¸»é¢˜åˆ‡æ¢
            document.getElementById('themeSelect').addEventListener('change', changeTheme);
            document.getElementById('animationSelect').addEventListener('change', changeAnimation);
        }

         åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn = btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content = content.classList.remove('active'));
            
            document.querySelector(`[data-tab=${tabName}]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

         å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            if (!appState.isRunning) {
                appState.isRunning = true;
                appState.isPaused = false;
                appState.focusStartTime = Date.now();
                
                if (appState.currentPhase === 'focus') {
                    playSound('focusStart');
                    scheduleNextBreak();
                }
                
                startBtn.textContent = 'ä¸“æ³¨ä¸­';
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                countdown();
                showNotification('å¼€å§‹ä¸“æ³¨ï¼ŒåŠ æ²¹ï¼', 'success');
            }
        }

         æš‚åœè®¡æ—¶å™¨
        function pauseTimer() {
            if (appState.isRunning && !appState.isPaused) {
                appState.isPaused = true;
                startBtn.textContent = 'ç»§ç»­';
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                 å–æ¶ˆå¾®ä¼‘æ¯è®¡æ—¶å™¨
                if (appState.microBreakTimer) {
                    clearTimeout(appState.microBreakTimer);
                    appState.microBreakTimer = null;
                }
                
                showNotification('æš‚åœè®¡æ—¶', 'info');
            } else if (appState.isPaused) {
                appState.isPaused = false;
                startBtn.textContent = 'ä¸“æ³¨ä¸­';
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                 é‡æ–°å®‰æ’å¾®ä¼‘æ¯
                if (appState.currentPhase === 'focus') {
                    scheduleNextBreak();
                }
                
                countdown();
                showNotification('ç»§ç»­ä¸“æ³¨', 'success');
            }
        }

         é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            appState.isRunning = false;
            appState.isPaused = false;
            appState.currentPhase = 'focus';
            appState.timeRemaining = settings.focusTime  60;
            appState.totalTime = settings.focusTime  60;
            
            if (appState.microBreakTimer) {
                clearTimeout(appState.microBreakTimer);
                appState.microBreakTimer = null;
            }
            
            startBtn.textContent = 'å¼€å§‹ä¸“æ³¨';
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            updateDisplay();
            scheduleNextBreak();
            showNotification('è®¡æ—¶å™¨å·²é‡ç½®', 'info');
        }

         å€’è®¡æ—¶
        function countdown() {
            if (!appState.isRunning  appState.isPaused) return;
            
            if (appState.timeRemaining = 0) {
                handlePhaseComplete();
                return;
            }
            
            appState.timeRemaining--;
            updateDisplay();
            
            setTimeout(countdown, 1000);
        }

         å¤„ç†é˜¶æ®µå®Œæˆ
        function handlePhaseComplete() {
            switch(appState.currentPhase) {
                case 'focus'
                     è®°å½•ä¸“æ³¨æ—¶é—´
                    recordFocusTime();
                    
                     å¼€å§‹é•¿æ—¶ä¼‘æ¯
                    appState.currentPhase = 'longBreak';
                    appState.timeRemaining = settings.longBreakDuration  60;
                    appState.totalTime = settings.longBreakDuration  60;
                    timerStatus.textContent = 'é•¿æ—¶ä¼‘æ¯ä¸­';
                    
                    playSound('longBreakStart');
                    showNotification(`ä¸“æ³¨å®Œæˆï¼å¼€å§‹${settings.longBreakDuration}åˆ†é’Ÿä¼‘æ¯`, 'success');
                    break;
                    
                case 'microBreak'
                     å¾®ä¼‘æ¯ç»“æŸï¼Œè¿”å›ä¸“æ³¨
                    appState.currentPhase = 'focus';
                    timerStatus.textContent = 'ä¸“æ³¨ä¸­';
                    
                    playSound('microBreakEnd');
                    showNotification('å¾®ä¼‘æ¯ç»“æŸï¼Œç»§ç»­ä¸“æ³¨ï¼', 'success');
                    scheduleNextBreak();
                    break;
                    
                case 'longBreak'
                     é•¿æ—¶ä¼‘æ¯ç»“æŸï¼Œå¼€å§‹æ–°çš„ä¸“æ³¨å‘¨æœŸ
                    appState.currentPhase = 'focus';
                    appState.timeRemaining = settings.focusTime  60;
                    appState.totalTime = settings.focusTime  60;
                    timerStatus.textContent = 'å‡†å¤‡å°±ç»ª';
                    
                    playSound('longBreakEnd');
                    showNotification('ä¼‘æ¯ç»“æŸï¼å‡†å¤‡å¼€å§‹æ–°çš„ä¸“æ³¨å‘¨æœŸ', 'success');
                    
                     è‡ªåŠ¨é‡ç½®åˆ°ç­‰å¾…çŠ¶æ€
                    appState.isRunning = false;
                    startBtn.textContent = 'å¼€å§‹ä¸“æ³¨';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    break;
            }
            
            updateDisplay();
            
             å¦‚æœä¸æ˜¯é•¿æ—¶ä¼‘æ¯ç»“æŸï¼Œç»§ç»­å€’è®¡æ—¶
            if (!(appState.currentPhase === 'focus' && appState.timeRemaining === settings.focusTime  60)) {
                countdown();
            }
        }

         å®‰æ’ä¸‹ä¸€æ¬¡å¾®ä¼‘æ¯
        function scheduleNextBreak() {
            if (appState.microBreakTimer) {
                clearTimeout(appState.microBreakTimer);
            }
            
            if (appState.currentPhase !== 'focus'  !appState.isRunning  appState.isPaused) {
                nextBreakTime.textContent = 'æš‚åœä¸­';
                return;
            }
            
            const minInterval = settings.minBreakInterval  60  1000;  è½¬æ¢ä¸ºæ¯«ç§’
            const maxInterval = settings.maxBreakInterval  60  1000;
            const randomInterval = Math.random()  (maxInterval - minInterval) + minInterval;
            
            appState.nextBreakTime = Date.now() + randomInterval;
            
             æ›´æ–°æ˜¾ç¤º
            const minutes = Math.floor(randomInterval  60000);
            const seconds = Math.floor((randomInterval % 60000)  1000);
            nextBreakTime.textContent = `${minutes}åˆ†${seconds}ç§’å`;
            
            appState.microBreakTimer = setTimeout(() = {
                if (appState.currentPhase === 'focus' && appState.isRunning && !appState.isPaused) {
                    startMicroBreak();
                }
            }, randomInterval);
        }

         å¼€å§‹å¾®ä¼‘æ¯
        function startMicroBreak() {
            appState.currentPhase = 'microBreak';
            appState.timeRemaining = settings.microBreakDuration;
            appState.totalTime = settings.microBreakDuration;
            timerStatus.textContent = 'å¾®ä¼‘æ¯ä¸­';
            
            playSound('microBreakStart');
            showNotification(`å¾®ä¼‘æ¯æ—¶é—´ï¼${settings.microBreakDuration}ç§’åç»§ç»­ä¸“æ³¨`, 'info');
            
            updateDisplay();
        }

         è®°å½•ä¸“æ³¨æ—¶é—´
        function recordFocusTime() {
            if (!appState.focusStartTime) return;
            
            const focusedMinutes = Math.floor((Date.now() - appState.focusStartTime)  60000);
            
             æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ä¸€å¤©
            const today = new Date().toDateString();
            if (stats.lastDate !== today) {
                resetDailyStats();
                stats.lastDate = today;
            }
            
            stats.today += focusedMinutes;
            stats.week += focusedMinutes;
            stats.month += focusedMinutes;
            stats.year += focusedMinutes;
            
            saveStats();
            updateStatsDisplay();
            
            appState.focusStartTime = null;
        }

         æ’­æ”¾å£°éŸ³
        function playSound(type) {
            if (!settings.notifications.sound) return;
            
             å¦‚æœæœ‰è‡ªå®šä¹‰éŸ³é¢‘ï¼Œæ’­æ”¾è‡ªå®šä¹‰éŸ³é¢‘
            if (settings.customAudio[type]) {
                const audio = new Audio(settings.customAudio[type]);
                audio.volume = settings.volume  100;
                audio.play().catch(e = console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥', e));
                return;
            }
            
             å¦åˆ™æ’­æ”¾é»˜è®¤éŸ³é¢‘ï¼ˆä½¿ç”¨AudioContextç”Ÿæˆï¼‰
            playDefaultSound(type);
        }

         æ’­æ”¾é»˜è®¤éŸ³æ•ˆ
        function playDefaultSound(type) {
            const audioContext = new (window.AudioContext  window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
             æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„éŸ³é¢‘å‚æ•°
            switch(type) {
                case 'focusStart'
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.5);
                    break;
                case 'microBreakStart'
                    oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                    break;
                case 'microBreakEnd'
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.3);
                    break;
                case 'longBreakStart'
                    oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(660, audioContext.currentTime + 1);
                    break;
                case 'longBreakEnd'
                    oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 0.8);
                    break;
            }
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(settings.volume  100  0.3, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        }

         é¢„è§ˆéŸ³é¢‘
        function playPreview(type) {
            playSound(type);
        }

         æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
             æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            const minutes = Math.floor(appState.timeRemaining  60);
            const seconds = appState.timeRemaining % 60;
            timerTime.textContent = `${minutes.toString().padStart(2, '0')}${seconds.toString().padStart(2, '0')}`;
            
             æ›´æ–°è¿›åº¦åœ†ç¯
            const progress = 1 - (appState.timeRemaining  appState.totalTime);
            const offset = 880 - (progress  880);
            progressCircle.style.strokeDashoffset = offset;
            
             æ ¹æ®é˜¶æ®µæ›´æ”¹è¿›åº¦åœ†ç¯é¢œè‰²
            switch(appState.currentPhase) {
                case 'focus'
                    progressCircle.style.stroke = '#667eea';
                    timerStatus.textContent = appState.isRunning  'ä¸“æ³¨ä¸­'  'å‡†å¤‡å°±ç»ª';
                    break;
                case 'microBreak'
                    progressCircle.style.stroke = '#4caf50';
                    timerStatus.textContent = 'å¾®ä¼‘æ¯ä¸­';
                    break;
                case 'longBreak'
                    progressCircle.style.stroke = '#ff9800';
                    timerStatus.textContent = 'é•¿æ—¶ä¼‘æ¯ä¸­';
                    break;
            }
            
             æ›´æ–°ä¸‹æ¬¡ä¼‘æ¯æ—¶é—´æ˜¾ç¤º
            if (appState.currentPhase === 'focus' && appState.isRunning && !appState.isPaused && appState.nextBreakTime) {
                const now = Date.now();
                const remaining = Math.max(0, appState.nextBreakTime - now);
                const minutes = Math.floor(remaining  60000);
                const seconds = Math.floor((remaining % 60000)  1000);
                
                if (remaining  0) {
                    nextBreakTime.textContent = `${minutes}åˆ†${seconds}ç§’å`;
                } else {
                    nextBreakTime.textContent = 'å³å°†åˆ°æ¥';
                }
            } else if (!appState.isRunning  appState.isPaused) {
                nextBreakTime.textContent = `${settings.minBreakInterval}-${settings.maxBreakInterval}åˆ†é’Ÿå`;
            }
        }

         æ›´æ–°ä¸“æ³¨æ—¶é—´è®¾ç½®
        function updateFocusTime() {
            const newTime = parseInt(document.getElementById('focusTime').value)  90;
            settings.focusTime = newTime;
            
            if (!appState.isRunning) {
                appState.timeRemaining = newTime  60;
                appState.totalTime = newTime  60;
                updateDisplay();
            }
            
            saveSettings();
        }

         æ›´æ–°éŸ³é‡
        function updateVolume() {
            const volume = parseInt(document.getElementById('volumeSlider').value);
            settings.volume = volume;
            document.getElementById('volumeValue').textContent = volume + '%';
            saveSettings();
        }

         è®¾ç½®éŸ³é¢‘ä¸Šä¼ 
        function setupAudioUploads() {
            const audioTypes = ['focusStart', 'microBreakStart', 'microBreakEnd', 'longBreakStart', 'longBreakEnd'];
            
            audioTypes.forEach(type = {
                const input = document.getElementById(type + 'Audio');
                const button = input.previousElementSibling;
                const fileName = document.getElementById(type + 'FileName');
                
                button.addEventListener('click', () = input.click());
                
                input.addEventListener('change', (e) = {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) = {
                            settings.customAudio[type] = e.target.result;
                            fileName.textContent = file.name;
                            saveSettings();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        }

         æ›´æ”¹ä¸»é¢˜
        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            settings.theme = theme;
            applyTheme(theme);
            saveSettings();
        }

         åº”ç”¨ä¸»é¢˜
        function applyTheme(theme) {
            const body = document.body;
            const themes = {
                default 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                forest 'linear-gradient(135deg, #2d5a27 0%, #4a7c59 100%)',
                sunset 'linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%)',
                ocean 'linear-gradient(135deg, #3742fa 0%, #2f3542 100%)'
            };
            
            body.style.background = themes[theme]  themes.default;
        }

         æ›´æ”¹åŠ¨ç”»æ•ˆæœ
        function changeAnimation() {
            const animation = document.getElementById('animationSelect').value;
            settings.animations = animation;
            applyAnimation(animation);
            saveSettings();
        }

         åº”ç”¨åŠ¨ç”»æ•ˆæœ
        function applyAnimation(animation) {
            const particlesContainer = document.getElementById('particles');
            
            switch(animation) {
                case 'particles'
                    createParticles();
                    break;
                case 'waves'
                    createWaves();
                    break;
                case 'none'
                    particlesContainer.innerHTML = '';
                    break;
            }
        }

         åˆ›å»ºç²’å­åŠ¨ç”»
        function createParticles() {
            const container = document.getElementById('particles');
            container.innerHTML = '';
            
            for (let i = 0; i  20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random()  100 + '%';
                particle.style.width = particle.style.height = Math.random()  4 + 2 + 'px';
                particle.style.animationDelay = Math.random()  15 + 's';
                particle.style.animationDuration = (Math.random()  10 + 10) + 's';
                container.appendChild(particle);
            }
        }

         åˆ›å»ºæ³¢æµªåŠ¨ç”»
        function createWaves() {
            const container = document.getElementById('particles');
            container.innerHTML = `
                svg width=100% height=100% viewBox=0 0 1200 600 style=position absolute; top 0; left 0;
                    path d=M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z 
                          fill=rgba(255,255,255,0.05)
                        animate attributeName=d 
                                 values=M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z;
                                         M0,300 Q300,400 600,300 T1200,300 L1200,600 L0,600 Z;
                                         M0,300 Q300,200 600,300 T1200,300 L1200,600 L0,600 Z
                                 dur=8s repeatCount=indefinite
                    path
                svg
            `;
        }

         æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
             æµè§ˆå™¨é€šçŸ¥
            if (settings.notifications.browser && 'Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('ä¸“æ³¨éŸµå¾‹', { body message, icon 'favicon.ico' });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission = {
                        if (permission === 'granted') {
                            new Notification('ä¸“æ³¨éŸµå¾‹', { body message, icon 'favicon.ico' });
                        }
                    });
                }
            }
            
            setTimeout(() = {
                notification.classList.remove('show');
            }, 3000);
        }

         æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStatsDisplay() {
            document.getElementById('todayTime').textContent = formatTime(stats.today);
            document.getElementById('weekTime').textContent = formatTime(stats.week);
            document.getElementById('monthTime').textContent = formatTime(stats.month);
            document.getElementById('yearTime').textContent = formatTime(stats.year);
        }

         æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(minutes) {
            if (minutes  60) {
                return minutes + 'åˆ†é’Ÿ';
            } else {
                const hours = Math.floor(minutes  60);
                const mins = minutes % 60;
                return `${hours}å°æ—¶${mins  0  mins + 'åˆ†é’Ÿ'  ''}`;
            }
        }

         é‡ç½®ç»Ÿè®¡æ•°æ®
        function resetStats(period) {
            if (confirm(`ç¡®å®šè¦é‡ç½®${{'day' 'ä»Šæ—¥', 'week' 'æœ¬å‘¨', 'month' 'æœ¬æœˆ', 'year' 'æœ¬å¹´'}[period]}çš„ç»Ÿè®¡æ•°æ®å—ï¼Ÿ`)) {
                switch(period) {
                    case 'day'
                        stats.today = 0;
                        break;
                    case 'week'
                        stats.week = 0;
                        break;
                    case 'month'
                        stats.month = 0;
                        break;
                    case 'year'
                        stats.year = 0;
                        break;
                }
                saveStats();
                updateStatsDisplay();
                showNotification(`${{'day' 'ä»Šæ—¥', 'week' 'æœ¬å‘¨', 'month' 'æœ¬æœˆ', 'year' 'æœ¬å¹´'}[period]}ç»Ÿè®¡å·²é‡ç½®`, 'success');
            }
        }

         è‡ªå®šä¹‰ç»Ÿè®¡è°ƒæ•´
        function customizeStats() {
            const customTime = prompt('è¯·è¾“å…¥è¦è°ƒæ•´çš„ä¸“æ³¨æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼š');
            if (customTime && !isNaN(customTime)) {
                const minutes = parseInt(customTime);
                const period = prompt('è°ƒæ•´å“ªä¸ªå‘¨æœŸï¼Ÿn1. ä»Šæ—¥n2. æœ¬å‘¨n3. æœ¬æœˆn4. æœ¬å¹´');
                
                switch(period) {
                    case '1'
                        stats.today = Math.max(0, minutes);
                        break;
                    case '2'
                        stats.week = Math.max(0, minutes);
                        break;
                    case '3'
                        stats.month = Math.max(0, minutes);
                        break;
                    case '4'
                        stats.year = Math.max(0, minutes);
                        break;
                    default
                        return;
                }
                
                saveStats();
                updateStatsDisplay();
                showNotification('ç»Ÿè®¡æ•°æ®å·²æ›´æ–°', 'success');
            }
        }

         æ£€æŸ¥æ—¥æœŸå˜åŒ–ï¼Œé‡ç½®æ¯æ—¥ç»Ÿè®¡
        function resetDailyStats() {
             è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„é€»è¾‘ï¼Œæ¯”å¦‚å°†æ˜¨æ—¥æ•°æ®ä¿å­˜åˆ°å†å²è®°å½•
            stats.today = 0;
        }

         ä¿å­˜è®¾ç½®åˆ° localStorage
        function saveSettings() {
            localStorage.setItem('focusRhythmSettings', JSON.stringify(settings));
        }

         ä» localStorage åŠ è½½è®¾ç½®
        function loadSettings() {
            const saved = localStorage.getItem('focusRhythmSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
                
                 æ›´æ–° UI
                document.getElementById('focusTime').value = settings.focusTime;
                document.getElementById('minBreakInterval').value = settings.minBreakInterval;
                document.getElementById('maxBreakInterval').value = settings.maxBreakInterval;
                document.getElementById('microBreakDuration').value = settings.microBreakDuration;
                document.getElementById('longBreakDuration').value = settings.longBreakDuration;
                document.getElementById('volumeSlider').value = settings.volume;
                document.getElementById('volumeValue').textContent = settings.volume + '%';
                document.getElementById('themeSelect').value = settings.theme;
                document.getElementById('animationSelect').value = settings.animations;
                
                 åº”ç”¨ä¸»é¢˜å’ŒåŠ¨ç”»
                applyTheme(settings.theme);
                applyAnimation(settings.animations);
                
                 æ›´æ–°è®¡æ—¶å™¨æ—¶é—´
                if (!appState.isRunning) {
                    appState.timeRemaining = settings.focusTime  60;
                    appState.totalTime = settings.focusTime  60;
                }
            }
        }

         ä¿å­˜ç»Ÿè®¡æ•°æ®åˆ° localStorage
        function saveStats() {
            localStorage.setItem('focusRhythmStats', JSON.stringify(stats));
        }

         ä» localStorage åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStats() {
            const saved = localStorage.getItem('focusRhythmStats');
            if (saved) {
                stats = { ...stats, ...JSON.parse(saved) };
                
                 æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ä¸€å¤©
                const today = new Date().toDateString();
                if (stats.lastDate !== today) {
                    resetDailyStats();
                    stats.lastDate = today;
                    saveStats();
                }
            }
            updateStatsDisplay();
        }

         é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && appState.isRunning && !appState.isPaused) {
                 é¡µé¢é‡æ–°å¯è§æ—¶ï¼Œé‡æ–°å®‰æ’å¾®ä¼‘æ¯ï¼ˆé˜²æ­¢æ—¶é—´ä¸å‡†ç¡®ï¼‰
                if (appState.currentPhase === 'focus') {
                    scheduleNextBreak();
                }
            }
        });

         é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName.toLowerCase() === 'input') return;
            
            switch(e.code) {
                case 'Space'
                    e.preventDefault();
                    if (!appState.isRunning) {
                        startTimer();
                    } else if (!appState.isPaused) {
                        pauseTimer();
                    } else {
                        pauseTimer();  ç»§ç»­
                    }
                    break;
                case 'KeyR'
                    if (e.ctrlKey  e.metaKey) {
                        e.preventDefault();
                        resetTimer();
                    }
                    break;
            }
        });

         å®šæœŸæ›´æ–°æ˜¾ç¤ºï¼ˆç”¨äºä¸‹æ¬¡ä¼‘æ¯æ—¶é—´å€’è®¡æ—¶ï¼‰
        setInterval(() = {
            if (appState.isRunning && !appState.isPaused && appState.currentPhase === 'focus') {
                updateDisplay();
            }
        }, 1000);
    script
body
html